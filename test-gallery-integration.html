<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gallery Performance Integration Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin-bottom: 30px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-section h3 {
            margin-top: 0;
            color: #333;
        }
        .status {
            padding: 5px 10px;
            border-radius: 3px;
            font-weight: bold;
        }
        .status.pass {
            background: #d4edda;
            color: #155724;
        }
        .status.fail {
            background: #f8d7da;
            color: #721c24;
        }
        .status.pending {
            background: #fff3cd;
            color: #856404;
        }
        .gallery-item {
            display: inline-block;
            margin: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            overflow: hidden;
        }
        .gallery-item img {
            width: 150px;
            height: 100px;
            object-fit: cover;
            display: block;
        }
        .filter-btn {
            padding: 8px 16px;
            margin: 5px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .filter-btn.active {
            background: #0056b3;
        }
        #performance-metrics {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>Gallery Performance Integration Test</h1>
        
        <div class="test-section">
            <h3>Performance System Status</h3>
            <div id="system-status" class="status pending">Initializing...</div>
            <div id="performance-metrics"></div>
        </div>

        <div class="test-section">
            <h3>Filter Integration Test</h3>
            <div>
                <button class="filter-btn active" data-filter="all">All Photos</button>
                <button class="filter-btn" data-filter="test1">Test Category 1</button>
                <button class="filter-btn" data-filter="test2">Test Category 2</button>
            </div>
            <div id="filter-status" class="status pending">Testing...</div>
        </div>

        <div class="test-section">
            <h3>Progressive Loading Test</h3>
            <div id="gallery-content">
                <div class="gallery-item" data-image-id="test-1">
                    <img src="https://picsum.photos/150/100?random=1" alt="Test Image 1" loading="lazy">
                </div>
                <div class="gallery-item" data-image-id="test-2">
                    <img src="https://picsum.photos/150/100?random=2" alt="Test Image 2" loading="lazy">
                </div>
                <div class="gallery-item" data-image-id="test-3">
                    <img src="https://picsum.photos/150/100?random=3" alt="Test Image 3" loading="lazy">
                </div>
                <div class="gallery-item" data-image-id="test-4">
                    <img src="https://picsum.photos/150/100?random=4" alt="Test Image 4" loading="lazy">
                </div>
            </div>
            <div id="loading-status" class="status pending">Testing...</div>
        </div>

        <div class="test-section">
            <h3>Performance Dashboard</h3>
            <p>Press 'P' to toggle the performance dashboard</p>
            <div id="dashboard-status" class="status pending">Testing...</div>
        </div>
    </div>

    <!-- Include the performance system -->
    <script src="assets/js/gallery-performance.js"></script>

    <script>
        // Test script
        let testResults = {
            systemInitialized: false,
            filterIntegration: false,
            progressiveLoading: false,
            performanceDashboard: false
        };

        // Test system initialization
        window.addEventListener('gallery-performance-ready', (event) => {
            testResults.systemInitialized = true;
            updateSystemStatus();
            
            // Test performance monitoring
            setTimeout(testPerformanceMonitoring, 1000);
            
            // Test filter integration
            setTimeout(testFilterIntegration, 2000);
            
            // Test progressive loading
            setTimeout(testProgressiveLoading, 3000);
            
            // Test dashboard
            setTimeout(testDashboard, 4000);
        });

        function updateSystemStatus() {
            const statusEl = document.getElementById('system-status');
            const metricsEl = document.getElementById('performance-metrics');
            
            if (testResults.systemInitialized) {
                statusEl.textContent = 'Performance System Initialized';
                statusEl.className = 'status pass';
                
                // Show performance metrics
                if (window.galleryPerformanceMonitor) {
                    const metrics = window.galleryPerformanceMonitor.getMetrics();
                    metricsEl.innerHTML = `
                        <div>Network Requests: ${metrics.networkRequests}</div>
                        <div>Memory Usage: ${(metrics.memoryUsage / 1024 / 1024).toFixed(1)}MB</div>
                        <div>Cache Hit Rate: ${(metrics.cacheHitRate * 100).toFixed(1)}%</div>
                        <div>User Interactions: ${metrics.userInteractions.length}</div>
                    `;
                }
            } else {
                statusEl.textContent = 'Performance System Failed to Initialize';
                statusEl.className = 'status fail';
            }
        }

        function testPerformanceMonitoring() {
            // Simulate some image loads
            if (window.galleryPerformanceMonitor) {
                window.galleryPerformanceMonitor.recordImageLoadTime('test-image-1', 150);
                window.galleryPerformanceMonitor.recordImageLoadTime('test-image-2', 200);
                window.galleryPerformanceMonitor.updateCacheHitRate(0.75);
                
                updateSystemStatus();
            }
        }

        function testFilterIntegration() {
            const filterButtons = document.querySelectorAll('.filter-btn');
            const statusEl = document.getElementById('filter-status');
            
            let interactionRecorded = false;
            
            // Listen for interaction recording
            const originalRecordInteraction = window.galleryPerformanceMonitor?.recordInteraction;
            if (originalRecordInteraction) {
                window.galleryPerformanceMonitor.recordInteraction = function(type, duration, context) {
                    if (type === 'filter') {
                        interactionRecorded = true;
                    }
                    return originalRecordInteraction.call(this, type, duration, context);
                };
            }
            
            // Simulate filter click
            filterButtons[1].click();
            
            setTimeout(() => {
                if (interactionRecorded) {
                    testResults.filterIntegration = true;
                    statusEl.textContent = 'Filter Integration Working';
                    statusEl.className = 'status pass';
                } else {
                    statusEl.textContent = 'Filter Integration Failed';
                    statusEl.className = 'status fail';
                }
            }, 500);
        }

        function testProgressiveLoading() {
            const statusEl = document.getElementById('loading-status');
            
            if (window.galleryProgressiveLoader) {
                testResults.progressiveLoading = true;
                statusEl.textContent = 'Progressive Loading System Active';
                statusEl.className = 'status pass';
            } else {
                statusEl.textContent = 'Progressive Loading System Failed';
                statusEl.className = 'status fail';
            }
        }

        function testDashboard() {
            const statusEl = document.getElementById('dashboard-status');
            
            // Check if dashboard exists
            const dashboard = document.querySelector('.performance-dashboard');
            
            if (dashboard) {
                testResults.performanceDashboard = true;
                statusEl.textContent = 'Performance Dashboard Available (Press P)';
                statusEl.className = 'status pass';
            } else {
                statusEl.textContent = 'Performance Dashboard Not Found';
                statusEl.className = 'status fail';
            }
        }

        // Initialize test after a short delay
        setTimeout(() => {
            if (!testResults.systemInitialized) {
                document.getElementById('system-status').textContent = 'Performance System Failed to Load';
                document.getElementById('system-status').className = 'status fail';
            }
        }, 5000);

        // Listen for performance reports
        window.addEventListener('gallery-performance-report', (event) => {
            console.log('Performance Report Received:', event.detail);
        });
    </script>
</body>
</html>